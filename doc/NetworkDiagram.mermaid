flowchart TD
    subgraph HOST["Host Machine (172.250.254.0/24)"]
        direction TB
        
        subgraph PORTS["Exposed Ports"]
            PORT80[Port 80 - Traefik]
            PORT8080[Port 8080 - Traefik Dashboard]
        end

        subgraph DOCKER_NET["Docker Overlay Network (assistant_lan)"]
            direction TB
            
            subgraph LB["Load Balancer Layer"]
                TRAEFIK[Traefik]
            end

            subgraph FE["Frontend Layer"]
                REACT1[React Instance 1]
                REACT2[React Instance 2]
            end

            subgraph API["API Layer"]
                API1[API Instance 1]
                API2[API Instance 2]
                API3[API Instance 3]
            end

            subgraph CACHE["Cache Layer"]
                REDIS1[Redis Node 1]
                REDIS2[Redis Node 2]
                REDIS3[Redis Node 3]
            end

            subgraph SEARCH["Search Layer"]
                ES[Elasticsearch]
            end

            subgraph DB["Database Layer"]
                subgraph PG["PostgreSQL Cluster"]
                    PG_PRIMARY[PostgreSQL Primary]
                    PG_REPLICA1[PostgreSQL Replica 1]
                    PG_REPLICA2[PostgreSQL Replica 2]
                end

                subgraph MONGO["MongoDB Replica Set"]
                    MONGO_PRIMARY[MongoDB Primary]
                    MONGO_SEC1[MongoDB Secondary 1]
                    MONGO_SEC2[MongoDB Secondary 2]
                end
            end
        end
    end

    %% External Connections
    INTERNET((Internet)) --> PORT80
    ADMIN((Admin)) --> PORT8080

    %% Internal Connections
    PORT80 --> TRAEFIK
    PORT8080 --> TRAEFIK
    
    %% Traefik to Services
    TRAEFIK --> REACT1 & REACT2
    TRAEFIK --> API1 & API2 & API3

    %% API to Cache
    API1 & API2 & API3 --> REDIS1 & REDIS2 & REDIS3
    API1 & API2 & API3 --> ES

    %% API to Databases
    API1 & API2 & API3 --> PG_PRIMARY
    API1 & API2 & API3 --> MONGO_PRIMARY

    %% Database Replication
    PG_PRIMARY --> PG_REPLICA1 & PG_REPLICA2
    MONGO_PRIMARY --> MONGO_SEC1 & MONGO_SEC2

    %% Styling
    classDef primary fill:#f96,stroke:#333,stroke-width:2px
    classDef secondary fill:#69f,stroke:#333,stroke-width:2px
    classDef cache fill:#9f6,stroke:#333,stroke-width:2px
    classDef lb fill:#f9f,stroke:#333,stroke-width:2px
    classDef external fill:#fff,stroke:#333,stroke-width:2px,stroke-dasharray: 5 5

    class TRAEFIK lb
    class REACT1,REACT2 secondary
    class API1,API2,API3 primary
    class REDIS1,REDIS2,REDIS3 cache
    class ES,PG_PRIMARY,MONGO_PRIMARY primary
    class PG_REPLICA1,PG_REPLICA2,MONGO_SEC1,MONGO_SEC2 secondary
    class INTERNET,ADMIN external

    %% Connection Labels
    linkStyle 0,1 stroke:#666,stroke-width:2px,stroke-dasharray: 5 5
    linkStyle 2,3 stroke:#666,stroke-width:2px
    linkStyle 4,5,6 stroke:#666,stroke-width:2px
    linkStyle 7,8,9,10,11 stroke:#666,stroke-width:2px
    linkStyle 12,13,14,15 stroke:#666,stroke-width:2px
    linkStyle 16,17 stroke:#f66,stroke-width:2px